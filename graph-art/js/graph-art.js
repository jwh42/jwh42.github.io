if(define("graph-art",["require","exports","ga-core-ui","ga-core-utils"],(function(e,t,i,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class r extends i.Control{constructor(){super(...arguments),this._handleBackgroundClick=()=>{r.close.raise(this)}}templateCallback(){i.DOM.invokeOnClick(this._background,this._handleBackgroundClick,!0),setTimeout(()=>this._content.style.marginLeft="0px")}}r.close=new a.Signal,t.MenuPanel=r})),define("graph-art",["require","exports","ga-core-ui","ga-core-utils","graph-art"],(function(e,t,i,a,r){"use strict";var s;Object.defineProperty(t,"__esModule",{value:!0});let n=s=class extends r.MenuPanel{templateCallback(){super.templateCallback(),this.toggleAttribute("data-loading",!0),fetch("demo/index.json").then(e=>e.json()).then(e=>{this.toggleAttribute("data-loading",!1),this._populateContent(e)}).catch(e=>{console.log(`Could not load demo index ${e}`)})}_populateContent(e){i.DOM.removeAll(this._items);for(let t=0;t<e.length;t++)this._items.appendChild(this._createButton(e[t]))}_createButton(e){const t=new i.ButtonBase;t.classList.add("example");const a=new Image;a.classList.add("image"),a.src=`demo/${e.id}.png`;const r=document.createElement("div");return r.classList.add("label"),r.textContent=e.label,t.appendChild(a),t.appendChild(r),i.ButtonBase.clicked.watch(t,()=>this._openExample(e.id)),t}_openExample(e){s.close.raise(this),s.exampleClicked.raise(this,e)}};n.exampleClicked=new a.Signal,n=s=__decorate([i.Control.register("ga-examples-grid-view")],n),t.ExamplesGridView=n})),define("graph-art",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})),define("graph-art",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});new Set(["pi"]);const i=new Set(["sin","asin","cos","acos","tan","atan","sqrt"]);t.GAReferenceValidator=class{constructor(e){this._functionArgs=e}validateFunctionRef(e,t){return i.has(e)?1!=t?`${e} expects 1 argument`:null:`Unknown function ${e}`}validateVariableRef(e){return null}}})),define("graph-art",["require","exports","ga-core-ast","graph-art"],(function(e,t,i,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class r{constructor(e,t,a){this.s=e,this.ast=t,this.arguments=a.slice(),this.variables=i.VariableRefEnumerator.enumerate(t)}static parse(e,t){const s=new a.GAReferenceValidator(t),n=i.AstParser.parseString(e,s);return new r(e,n,t)}}t.GAFunc=r})),define("graph-art",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class i{constructor(e,t){this.s=e,this.v=t}static tryParse(e){const t=parseFloat(e);return isNaN(t)?null:new i(e,t)}}t.RangePart=i})),define("graph-art",["require","exports","ga-core-utils","graph-art"],(function(e,t,i,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=a.RangePart.tryParse("0"),s=a.RangePart.tryParse("1"),n=a.RangePart.tryParse("0.001");class h{constructor(e){this.name=e,this._min=r,this._max=s,this._step=n,this._mode=0,this._duration=1e4,this._value=0,this._offset=0,this._decrease=!1,this.referenceCount=1}get step(){return this._step}get min(){return this._min}get max(){return this._max}get mode(){return this._mode}get duration(){return this._duration}get value(){return this._value}set value(e){this._value=e,h.valueChanged.raise(this)}applyJson(e){this.trySetRange(e.step,e.min,e.max),this.setAnimationMode(e.mode,e.duration)}serialize(){return{name:this.name,step:this.step.s,min:this.min.s,max:this.max.s,mode:this.mode,duration:this.duration}}clampValue(e){return Math.min(Math.max(e,this.min.v),this.max.v)}slotValue(e){return Math.round(e/this.step.v)*this.step.v}trySetRange(e,t,i){const r=a.RangePart.tryParse(e),s=a.RangePart.tryParse(t),n=a.RangePart.tryParse(i);return!!(r&&s&&n)&&(this.setRange(r,s,n),!0)}setRange(e,t,a){if(this._step=i.throwIfNull(e,"step"),this._min=i.throwIfNull(t,"min"),this._max=i.throwIfNull(a,"max"),this._max.v<this._min.v){const e=this._max;this._max=this._min,this._min=e}this._value<this._min.v&&(this.value=this._min.v),this._value>this._max.v&&(this.value=this._max.v)}setAnimationMode(e,t){this._mode=e,this._duration=t,h.animationModeChanged.raise(this)}updateAnimationOffset(e){const t=this._min.v,i=this._duration,a=(this._value-t)/(this._max.v-t),r=Math.floor(i*a);switch(this._mode){case 1:this._offset=(r+i-e%i)%i;break;case 2:const t=2*i,a=t+r*(this._decrease?-1:1);this._offset=(a-e%t)%t;break;default:this._offset=0}}updateValueForAnimation(e){switch(this._mode){case 1:this._decrease=!1,this._setValueForTime((e+this._offset)%this._duration);break;case 2:const t=this._duration,i=2*t,a=(e+this._offset)%i;this._decrease=a>t,this._setValueForTime(this._decrease?i-a:a)}}_setValueForTime(e){const t=this.step.v,i=this._min.v,a=i+e/this._duration*(this._max.v-i);this.value=Math.round(a/t)*t}}h.userFocus=new i.Signal,h.userBlur=new i.Signal,h.valueChanged=new i.Signal,h.animationModeChanged=new i.Signal,t.Variable=h})),define("graph-art",["require","exports","ga-core-utils","graph-art"],(function(e,t,i,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});let r=class{constructor(){this._listenToVariable=!0,this._startTime=Date.now(),this._varByName=new Map,this._varByList=new i.SignalingArray,this._isPlayAvailable=new i.SignalingValue,this._isPlayOnHold=new i.SignalingValue,this._isPlaying=new i.SignalingValue,this._isPlayEnabled=new i.SignalingValue(!1,e=>{this._isPlayOnHold.value||(e?this._resumePlayback():this._pausePlayback())}),this._handleVarFocus=()=>{this._isPlayOnHold.value=!0,this._pausePlayback()},this._handleVarBlur=()=>{this._isPlayOnHold.value=!1,this._isPlayEnabled.value&&this._resumePlayback()},this._handleVarValueChanged=e=>{this._listenToVariable&&e.updateAnimationOffset(Date.now()-this._startTime)},this._handleVarAniChanged=e=>{e.updateAnimationOffset(Date.now()-this._startTime),this._updatePlaybackAvailable()}}get variables(){return this._varByList}get isPlayAvailable(){return this._isPlayAvailable}get isPlayEnabled(){return this._isPlayEnabled}get isPlayOnHold(){return this._isPlayOnHold}get isPlaying(){return this._isPlaying}get(e){return this._varByName.get(e)||null}isConstant(e){return/^pi$/i.test(e)}applyJson(e){for(let t=0;t<e.length;t++){const i=e[t],a=this.get(i.name);a&&a.applyJson(i)}}serialize(){return this._varByList.map(e=>e.serialize())}retainAndListVariablesInFuncs(e,t){const i=new Set;this.retainVariablesInFuncs(e,i),t.length=0,t.push(...i)}retainVariablesInFuncs(e,t){i.throwIfNull(e,"functions");for(let i=0;i<e.length;i++)this.retainVariablesInFunc(e[i],t)}retainVariablesInFunc(e,t){i.throwIfNull(e,"func");for(let i of e.variables)if(this._canRetain(i,e)){const e=this.retainVariable(i);t&&t.add(e)}}releaseVariablesInFuncs(e){i.throwIfNull(e,"functions");for(let t=0;t<e.length;t++)this.releaseVariablesInFunc(e[t])}releaseVariablesInFunc(e){i.throwIfNull(e,"func");for(let t of e.variables)this._canRetain(t,e)&&this.releaseVariable(t)}retainVariable(e){let t=this._varByName.get(e)||null;return t?t.referenceCount++:(t=new a.Variable(e),this._varByList.push(t),this._varByName.set(e,t),a.Variable.userBlur.watch(t,this._handleVarBlur),a.Variable.userFocus.watch(t,this._handleVarFocus),a.Variable.valueChanged.watch(t,this._handleVarValueChanged),a.Variable.animationModeChanged.watch(t,this._handleVarAniChanged)),t}releaseVariable(e){const t=this._varByName.get(e)||null;return!!t&&(--t.referenceCount<=0&&(a.Variable.userBlur.unwatch(t,this._handleVarBlur),a.Variable.userFocus.unwatch(t,this._handleVarFocus),a.Variable.valueChanged.unwatch(t,this._handleVarValueChanged),a.Variable.animationModeChanged.unwatch(t,this._handleVarAniChanged),this._varByName.delete(e),this._varByList.remove(t),this._updatePlaybackAvailable()),!0)}updateValuesForPlayback(){if(this._isPlaying.value){this._listenToVariable=!1;const e=Date.now()-this._startTime;for(let t=0,i=this._varByList.length;t<i;t++)this._varByList[t].updateValueForAnimation(e);this._listenToVariable=!0}}_pausePlayback(){this._isPlaying.value=!1}_resumePlayback(){this._startTime=Date.now();for(let e=0,t=this._varByList.length;e<t;e++)this._varByList[e].updateAnimationOffset(0);this._isPlaying.value=!0}_updatePlaybackAvailable(){const e=this._varByList.some(e=>0!=e.mode);this._isPlayAvailable.value!=e&&(this._isPlaying.value&&!e&&this._pausePlayback(),this._isPlayAvailable.value=e)}_canRetain(e,t){return!this.isConstant(e)&&t.arguments.indexOf(e)<0}};r=__decorate([i.DI.singleton()],r),t.VariableManager=r})),define("graph-art",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})),define("graph-art",["require","exports","ga-core-utils"],(function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class a{constructor(){this._parent=null,this.label="",this.expandedPropertyGroups=new Set}get parent(){return this._parent}get variableManager(){return this._parent&&this._parent.variableManager}serialize(){return null}createSavePoint(){return null}restoreSavePoint(e){}releaseVariables(){}retainVariables(){}setParent(e){if(this._parent&&e)throw new Error("Object already has a parent");this._parent&&this._parent.variableManager&&this.releaseVariables(),this._parent=e,e&&e.variableManager&&this.retainVariables()}}a.showDetails=new i.Signal,t.GAObject=a})),define("graph-art",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=new Map;t.Serialization=class{static registerType(e,t){return a=>{const r=i.get(e)||new Map;i.set(e,r),r.set(t,a)}}static deserializeAs(e,t){const a=t.type;if(!a)return console.warn(`Cannot deserialize as ${e.name}: type not set`),null;const r=i.get(e),s=r&&r.get(a);return s?s.deserialize(t):(console.warn(`Nothing registered to deserialize ${e.name}/${a}`),null)}}})),define("graph-art",["require","exports","ga-core-utils","graph-art","graph-art","graph-art"],(function(e,t,i,a,r,s){"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0});let h=n=class extends a.GAObject{constructor(){super(...arguments),this._children=new Array}get viewKey(){return n.viewKey}get count(){return this._children.length}get(e){return i.throwIfOutOfBounds(e,this._children.length,"index"),this._children[e]}static deserialize(e){const t=new n;return t.applyJson(e),t}applyJson(e){this.clear();for(let t=0;t<e.length;t++){const i=r.Serialization.deserializeAs(a.GAObject,e[t]);i&&this.add(i)}}serialize(){return this._children.map(e=>e.serialize())}releaseVariables(){super.releaseVariables();for(let e=0;e<this._children.length;e++)this._children[e].releaseVariables()}retainVariables(){super.retainVariables();for(let e=0;e<this._children.length;e++)this._children[e].retainVariables()}add(e){this.insert(this._children.length,e)}insert(e,t){i.throwIfNull(t,"obj"),i.throwIfOutOfBounds(e,this._children.length+1,"index"),t.setParent(this),this._children.insertAt(e,t),n.inserted.raise(this,e)}remove(e){i.throwIfNull(e,"child");const t=this._children.indexOf(e);return t>=0&&(this._removeCore(t),!0)}clear(){for(let e=this._children.length-1;e>=0;e--)this._removeCore(e)}_removeCore(e){n.removing.raise(this,e),this._children[e].setParent(null),this._children.removeAt(e)}};h.viewKey="group",h.rootKey="RootObject",h.inserted=new i.Signal,h.removing=new i.Signal,h=n=__decorate([r.Serialization.registerType(a.GAObject,"group")],h),t.ObjectGroup=h;let o=class extends h{constructor(e){super(),this._varManager=e}get variableManager(){return this._varManager}};o=__decorate([i.DI.singleton(h.rootKey),__param(0,i.DI.one(s.VariableManager))],o)})),define("graph-art",["require","exports","ga-core-utils"],(function(e,t,i){"use strict";var a;Object.defineProperty(t,"__esModule",{value:!0});let r=a=class{constructor(){this._cameraXY=Math.PI/8,this._cameraYZ=Math.PI/8,this._cameraDistance=10}get cameraXY(){return this._cameraXY}get cameraYZ(){return this._cameraYZ}get cameraDistance(){return this._cameraDistance}applyJson(e){this.setCameraPosition(e.distance,e.xyRad,e.yzRad)}serialize(){return{distance:this.cameraDistance,xyRad:this.cameraXY,yzRad:this.cameraYZ}}setCameraPosition(e,t,i){this._cameraXY=t,this._cameraYZ=i,this._cameraDistance=e,a.cameraMoved.raise(this)}};r.cameraMoved=new i.Signal,r=a=__decorate([i.DI.singleton()],r),t.ViewManager=r})),define("graph-art",["require","exports","graph-art","graph-art","graph-art"],(function(e,t,i,a,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.AppState=class{static serializeApp(e){const t=e.get(i.ObjectGroup,i.ObjectGroup.rootKey),s=e.get(a.VariableManager);return{camera:e.get(r.ViewManager).serialize(),objects:t.serialize(),variables:s.serialize()}}static deserializeApp(e,t){if(t.camera){e.get(r.ViewManager).applyJson(t.camera)}if(t.objects){e.get(i.ObjectGroup,i.ObjectGroup.rootKey).applyJson(t.objects)}if(t.variables){e.get(a.VariableManager).applyJson(t.variables)}}}})),define("graph-art",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})),define("graph-art",["require","exports","graph-art"],(function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class a extends i.GAObject{}a.funcArgs=["s","t"],t.GraphSurface=a})),define("graph-art",["require","exports","ga-core-utils","graph-art","graph-art","graph-art"],(function(e,t,i,a,r,s){"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0});let h=n=class extends r.GraphSurface{constructor(e,t){super(),this.functions=e,this.mode=t,this._variables=new Array,i.throwIfEmpty(e,"functions")}get viewKey(){return n.viewKey}get variables(){return this._variables}static deserialize(e){return new n(e.functions.map(e=>a.GAFunc.parse(e,r.GraphSurface.funcArgs)),0)}static createDefault(){return new n([a.GAFunc.parse("0.1",r.GraphSurface.funcArgs),a.GAFunc.parse("0.1",r.GraphSurface.funcArgs),a.GAFunc.parse("0.8",r.GraphSurface.funcArgs)],0)}serialize(){return{type:n.viewKey,functions:this.functions.map(e=>e.s)}}releaseVariables(){this.variableManager.releaseVariablesInFuncs(this.functions),super.releaseVariables()}retainVariables(){this.variableManager.retainAndListVariablesInFuncs(this.functions,this._variables),super.retainVariables()}};h.viewKey="colorFuncs",h=n=__decorate([s.Serialization.registerType(r.GraphSurface,"colorFuncs")],h),t.ColorFuncsSurface=h})),define("graph-art",["require","exports","graph-art","ga-core-utils"],(function(e,t,i,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=1,s=500,n=50,h=i.RangePart.tryParse("-1"),o=i.RangePart.tryParse("1");class l{constructor(e,t,i,r){this.name=e,this.resolution=t,this.min=i,this.max=r,a.throwIfEmpty(e,"name"),a.throwIfNull(i,"min"),a.throwIfNull(r,"max")}static parseOrDefault(e,t,a,r){const s=i.RangePart.tryParse(a),n=i.RangePart.tryParse(r);return!isNaN(t)&&s&&n?new l(e,this.clampResolution(t),s,n):this.createDefault(e)}static createDefault(e){return new l(e,n,h,o)}static clampResolution(e){return Math.min(Math.max(e,r),s)}}t.GraphArgument=l})),define("graph-art",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})),define("graph-art",["require","exports","ga-core-ast","ga-core-utils","graph-art","graph-art","graph-art","graph-art","graph-art","graph-art","graph-art"],(function(e,t,i,a,r,s,n,h,o,l,c){"use strict";var u;Object.defineProperty(t,"__esModule",{value:!0});let d=u=class extends n.GAObject{constructor(){super(),this._mode=0,this._surface=null,this._functions=new Array,this._variables=new Array,this._graphArgs=new Array,this._surface=r.ColorFuncsSurface.createDefault(),this._surface.setParent(this)}get viewKey(){return u.viewKey}get mode(){return this._mode}get arguments(){return this._graphArgs}get functions(){return this._functions}get variables(){return this._variables}get surface(){return this._surface}static deserialize(e){const t=new u,a=e.arguments.map(e=>e.name),r=new h.GAReferenceValidator(a),n=e.arguments.map(e=>o.GraphArgument.parseOrDefault(e.name,e.resolution,e.min,e.max)),d=e.functions.map(e=>new s.GAFunc(e,i.AstParser.parseString(e,r),a));if(t.label=e.label,t.setFunctions(n,d,e.mode),e.surface){const i=c.Serialization.deserializeAs(l.GraphSurface,e.surface);i&&t.setSurface(i)}return t}serialize(){return{type:u.viewKey,mode:this.mode,label:this.label,surface:this.surface.serialize(),functions:this.functions.map(e=>e.s),arguments:this.arguments.map(e=>({name:e.name,resolution:e.resolution,min:e.min.s,max:e.max.s}))}}createSavePoint(){return{mode:this._mode,functions:this._functions.slice(),arguments:this._graphArgs.slice()}}restoreSavePoint(e){this.setFunctions(e.arguments,e.functions,e.mode)}remove(e){return!1}setFunctions(e,t,i){a.throwIfEmpty(e,"graphArgs"),a.throwIfEmpty(t,"functions"),this.variableManager&&(this._retainVariables(t),this._releaseVariables(this._functions)),this._mode=i,this._graphArgs.length=0,this._graphArgs.push(...e),this._functions.length=0,this._functions.push(...t),u.changed.raise(this)}setSurface(e){a.throwIfNull(e,"surface"),this._surface.setParent(null),this._surface=e,this._surface.setParent(this),u.changed.raise(this)}releaseVariables(){this._surface.releaseVariables(),this._releaseVariables(this._functions),super.releaseVariables()}retainVariables(){this._surface.retainVariables(),this._retainVariables(this._functions),super.retainVariables()}_retainVariables(e){this.variableManager.retainAndListVariablesInFuncs(e,this._variables)}_releaseVariables(e){this.variableManager.releaseVariablesInFuncs(e)}};d.viewKey="graph",d.changed=new a.Signal,d=u=__decorate([c.Serialization.registerType(n.GAObject,"graph")],d),t.Graph=d})),define("graph-art",["require","exports","ga-core-ui","ga-core-ui!graph-art","graph-art","graph-art"],(function(e,t,i,a,r,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});let n=class extends r.MenuPanel{constructor(e,t){super(),this._factory=e,this._root=t}templateCallback(){super.templateCallback(),this._createIco.content.value=a.add;for(let e=0,t=this._root.count;e<t;e++){const t=this._root.get(e),a=new i.ButtonBase;a.classList.add("object-tree-row"),a.textContent=t.label,i.ButtonBase.clicked.watch(a,()=>{this._showDetails(t,!1)}),this._itemsArea.insertBefore(a,this._itemsArea.firstChild)}i.ButtonBase.clicked.watch(this._createBtn,()=>{const e=this._factory();e.label="Item "+(this._root.count+1),this._root.add(e),this._showDetails(e,!0)})}_showDetails(e,t){s.GAObject.showDetails.raise(e,t),r.MenuPanel.close.raise(this)}};n=__decorate([i.Control.register("ga-object-tree-view")],n),t.ObjectTreeView=n})),define("graph-art",["require","exports","ga-core-ui"],(function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});let a=class extends i.Button{};a=__decorate([i.Control.register("ga-playback-button")],a),t.PlaybackButton=a})),define("graph-art",["require","exports","ga-core-utils"],(function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class a extends HTMLElement{}a.propertyChanged=new i.Signal,t.IPropertyGroupControl=a})),define("graph-art",["require","exports","ga-core-ui"],(function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});let a=class extends i.Control{constructor(e,t,a){super(),this._model=e,this._view=t,this._default=a,this.expanded=new i.BindableValue(!1,e=>{this.isConnected&&this._updateMarginTop(),this.toggleAttribute("data-expanded",e)})}connectedCallback(){super.connectedCallback(),this._updateMarginTop()}templateCallback(){this._labelArea.textContent=this._view.label,i.ButtonBase.clicked.watch(this._header,()=>this.headerClicked());const e=this._model.expandedPropertyGroups;this.expanded.value=e.has(this._view.configKey)||0==e.size&&this._default,this._frameArea.appendChild(this._view),this._view.classList.add("content");const t=this._view.style;t.transition="none",setTimeout(()=>t.removeProperty("transition"))}headerClicked(){const e=!this.expanded.value,t=this._model.expandedPropertyGroups;this.expanded.value=e,e?t.add(this._view.configKey):t.delete(this._view.configKey)}_updateMarginTop(){this._view.style.marginTop=-Math.ceil(this._view.offsetHeight)+"px"}};a=__decorate([i.Control.register("ga-property-group-container")],a),t.PropertyGroupContainer=a})),define("graph-art",["require","exports","ga-core-ui","ga-core-ui!graph-art","ga-core-utils","graph-art","graph-art"],(function(e,t,i,a,r,s,n){"use strict";var h;Object.defineProperty(t,"__esModule",{value:!0});let o=h=class extends i.Control{constructor(e){super(),this._editorTypes=e,this._views=new Array,this._object=null,this._savePoint=null,this.isPreExistingObject=new i.BindableValue(!0,e=>{this.isInitialized&&(this._revert.visible.value=e,this._delete.visible.value=e)}),this.hasChangedSinceOpen=new i.BindableValue(!1,e=>{this.isInitialized&&(this._revert.enabled.value=e)}),this.hasUncommittedChanges=new i.BindableValue(!1,e=>{this.isInitialized&&(this._apply.enabled.value=e)}),this._handleChange=()=>{this.hasChangedSinceOpen.value=!0,this.hasUncommittedChanges.value=!0}}static createProvider(e,t,i){return new l(e,t,i)}setObject(e,t){this._object=e,this._savePoint=e.createSavePoint(),this.isConnected&&(this._label.value=e.label),this.isPreExistingObject.value=!t,this.hasUncommittedChanges.value=t}templateCallback(){i.ButtonBase.clicked.watch(this._okBtn,()=>this.okClicked()),i.ButtonBase.clicked.watch(this._cancel,()=>this.cancelClicked()),i.ButtonBase.clicked.watch(this._apply,()=>this.applyClicked()),i.ButtonBase.clicked.watch(this._revert,()=>this.revertClicked()),i.ButtonBase.clicked.watch(this._delete,()=>this.deleteClicked()),this._delete.content.value=a.trash,this._delete.visible.value=this.isPreExistingObject.value,this._revert.visible.value=this.isPreExistingObject.value,this._revert.enabled.value=this.hasChangedSinceOpen.value,this._apply.enabled.value=this.hasUncommittedChanges.value,this._object&&(this._createPropertyGroupViews(),this._label.value=this._object.label),this._label.addEventListener("change",this._handleChange,!0),setTimeout(()=>this.toggleAttribute("data-expanded",!0))}okClicked(){this.hasUncommittedChanges.value&&!this._tryApplyChanges()||this._removeSelf()}cancelClicked(){this.isPreExistingObject.value?(this._revertChanges(),this._removeSelf()):this.deleteClicked()}applyClicked(){this._tryApplyChanges()}revertClicked(){this._revertChanges(),i.DOM.removeAll(this._groups),this._createPropertyGroupViews(),this._label.value=this._object.label,this.hasChangedSinceOpen.value=!1,this.hasUncommittedChanges.value=!1}deleteClicked(){const e=this._object.parent;e&&e.remove(this._object)&&this._removeSelf()}_createPropertyGroupViews(){for(let e=0;e<this._editorTypes.length;e++){const t=this._editorTypes[e],i=r.DI.create(t,r.DI.services);i.setObject(this._object),this._views.push(i),this._groups.appendChild(new n.PropertyGroupContainer(this._object,i,0==e)),s.IPropertyGroupControl.propertyChanged.watch(i,this._handleChange)}}_tryApplyChanges(){const e=this._validateChanges();return e?e.scrollIntoView():this._applyChanges(),null==e}_validateChanges(){let e=null;for(let t=0;t<this._views.length;t++){const i=this._views[t].validateChanges();e=e||i}return e}_applyChanges(){for(let e=0;e<this._views.length;e++)this._views[e].applyChanges();this._object.label=this._label.value,this.hasUncommittedChanges.value=!1}_revertChanges(){this._object.restoreSavePoint(this._savePoint)}_removeSelf(){const e=()=>{this.parentNode&&this.parentNode.removeChild(this),this.removeEventListener("transitionend",e,!0)};this.addEventListener("transitionend",e,!0),this.toggleAttribute("data-expanded",!1),h.removing.raise(this)}};o.removing=new r.Signal,o=h=__decorate([i.Control.register("ga-property-panel")],o),t.PropertyPanel=o;class l{constructor(e,t,i){this.key=e,this.insertOrder=t,this.editorTypes=i}get(){return new o(this.editorTypes)}resolved(e){for(let t=0;t<this.editorTypes.length;t++)if(!r.DI.resolved(this.editorTypes[t],e))return!1;return!0}}})),define("graph-art",["require","exports","ga-core-ui","ga-core-ui!graph-art","ga-core-utils","graph-art","graph-art","graph-art","graph-art","graph-art","graph-art","graph-art","graph-art","graph-art"],(function(e,t,i,a,r,s,n,h,o,l,c,u,d,_){"use strict";Object.defineProperty(t,"__esModule",{value:!0});let p=class extends i.Control{constructor(e,t){super(),this._objects=e,this._variables=t,this._handleOpenDemo=(e,t)=>{fetch(`demo/${t}.ga`).then(e=>e.json()).then(e=>{h.AppState.deserializeApp(r.DI.services,e)}).catch(e=>{console.warn(e),i.MessageBox.show(`Could not open '${t}'`)})},this._handleOpenFile=()=>{if(0==this._inpOpen.files.length)return;const e=this._inpOpen.files[0];(function(e){return new Promise((t,i)=>{const a=new FileReader;a.onload=()=>{try{t(JSON.parse(a.result))}catch(e){i(e)}},a.onerror=()=>{i(a.error)},a.readAsText(e)})})(e).then(t=>{try{h.AppState.deserializeApp(r.DI.services,t)}catch(t){console.warn(t),i.MessageBox.show(`'${e.name}' contained invalid data.`)}}),this._inpOpen.value=null},this._handleShowDetails=(e,t)=>{const a=r.DI.services.one(_.PropertyPanel,e.viewKey);a.setObject(e,t),i.DOM.removeAll(this._editArea),this._editArea.appendChild(a),this._menuFade.style.display="block",_.PropertyPanel.removing.watch(a,this._handleEditorClosed)},this._handleEditorClosed=e=>{_.PropertyPanel.removing.unwatch(e,this._handleEditorClosed),this._menuFade.style.display="none"}}connectedCallback(){super.connectedCallback(),o.GAObject.showDetails.watchAnySender(this._handleShowDetails)}disconnectedCallback(){super.disconnectedCallback(),o.GAObject.showDetails.unwatchAnySender(this._handleShowDetails)}templateCallback(){this._icoObjects.content.value=a.object,this._icoDemo.content.value=a.demos,this._icoOpen.content.value=a.open,this._icoSave.content.value=a.save,this._playback.title="Play/Pause",this._btnObjects.title="Modify objects",this._btnDemo.title="View example scenes",this._btnSave.title="Save current scene",this._inpOpen.title="Open saved scene",i.ButtonBase.clicked.watch(this._playback,()=>this.togglePlayback()),i.ButtonBase.clicked.watch(this._btnObjects,()=>this.objectsClicked()),i.ButtonBase.clicked.watch(this._btnDemo,()=>this.demoClicked()),i.ButtonBase.clicked.watch(this._btnSave,()=>this.saveClicked()),this._bindPlaybackState(this._variables.isPlayOnHold,"data-holding"),this._bindPlaybackState(this._variables.isPlayEnabled,"data-playing"),this._bindPlaybackState(this._variables.isPlayAvailable,"data-visible"),this._inpOpen.addEventListener("change",this._handleOpenFile,!0)}togglePlayback(){this._variables.isPlayEnabled.value=!this._variables.isPlayEnabled.value}objectsClicked(){this._showMenuPanel(this._btnObjects,new d.ObjectTreeView(()=>new l.Graph,this._objects))}demoClicked(){const e=new s.ExamplesGridView;s.ExamplesGridView.exampleClicked.watch(e,this._handleOpenDemo),this._showMenuPanel(this._btnDemo,e)}saveClicked(){!function(e,t){const i=JSON.stringify(e),a=new Blob([i],{type:"application/json"}),r=document.createElement("a");r.href=URL.createObjectURL(a),r.download=t,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(r.href)}(h.AppState.serializeApp(r.DI.services),"scene.ga")}_showMenuPanel(e,t){n.MenuPanel.close.watch(t,t=>{this._listArea.removeChild(t),e.toggleAttribute("active",!1)}),e.toggleAttribute("active",!0),this._listArea.appendChild(t)}_bindPlaybackState(e,t){e.watch(e=>this._playback.toggleAttribute(t,e))}};p=__decorate([i.Control.register("ga-application"),__param(0,r.DI.one(c.ObjectGroup,c.ObjectGroup.rootKey)),__param(1,r.DI.one(u.VariableManager))],p),t.Application=p})),define("graph-art",["require","exports","ga-core-ast","ga-core-ui","ga-core-utils","graph-art"],(function(e,t,i,a,r,s){"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0});const h="syntax-err",o=/^[\n\r]+|[\n\r]+$|\r/g;let l=n=class extends a.Control{constructor(){super(...arguments),this._preInitValue="",this._errorSrt=0,this._errorLen=0,this.label=new a.BindableValue(null,e=>{this.isConnected&&(this._label.textContent=e)}),this._handleFocus=()=>{this._clearErrorHighlight()},this._handleBlur=()=>{this._errorLen>0&&this._highlightError(this._errorSrt,this._errorLen)},this._handlePaste=e=>{if(e.clipboardData){const t=e.clipboardData.getData("text/plain");document.execCommand("insertText",!1,t),e.preventDefault()}},this._handleInput=()=>{this._errorLen=0,n.changed.raise(this)}}setString(e){this.isInitialized?this._input.innerText=e:this._preInitValue=e}getString(){if(this.isInitialized){const e=new Array;return function e(t,i){for(let a=i.firstChild;null!=a;a=a.nextSibling)switch(a.nodeType){case Node.ELEMENT_NODE:u(a)&&t.push("\n"),e(t,a);break;case Node.TEXT_NODE:t.push(a.nodeValue.replace(o,""))}}(e,this._input),e.join("")}return this._preInitValue}getFuncOrShowError(e,t){let a=null,r=this.getString();this._message.textContent="",this.toggleAttribute("data-invalid",!1);try{a=i.AstParser.parseString(r,t)}catch(e){return this.toggleAttribute("data-invalid",!0),this._message.textContent=e.message,e instanceof i.AstParseError&&this._highlightError(e.position,e.length),null}return new s.GAFunc(r,a,e)}templateCallback(){this._label.textContent=this.label.value,this._input.innerText=this._preInitValue,this._preInitValue="",this._input.addEventListener("paste",this._handlePaste),this._input.addEventListener("input",this._handleInput),this._input.addEventListener("focus",this._handleFocus),this._input.addEventListener("blur",this._handleBlur)}_highlightError(e,t){this._errorSrt=e,this._errorLen=t,this._clearErrorHighlight(),function e(t){for(let i=t.firstChild;null!=i;i=i.nextSibling)i.nodeType==Node.ELEMENT_NODE?e(i):i.nodeType==Node.TEXT_NODE&&o.test(i.nodeValue)&&(i.nodeValue=i.nodeValue.replace(o,""))}(this._input),function e(t,i,a){let r=0;for(let s=t.firstChild;null!=s;){let t=0,n=s;switch(s=s.nextSibling,n.nodeType){case Node.TEXT_NODE:t=c(n,i,i+a);break;case Node.ELEMENT_NODE:u(n)&&(i-=1,r+=1),t=e(n,i,a)}i-=t,r+=t}return r}(this._input,e,t)}_clearErrorHighlight(){!function e(t){for(let i=t.firstElementChild;null!=i;){let t=i;i=i.nextElementSibling,d(t)?t.parentElement.replaceChild(t.firstChild,t):e(t)}}(this._input),this._input.normalize()}};function c(e,t,i){const a=e.textContent.length;if(a>=t&&i>0){const r=i<a?e.splitText(i):e.nextSibling,s=t>=0?e.splitText(t):e,n=e.parentElement;n.removeChild(s);const o=document.createElement("span");o.classList.add(h),o.appendChild(s),n.insertBefore(o,r)}return a}function u(e){return"BR"==e.tagName&&"_moz"!=e.getAttribute("type")||"DIV"==e.tagName}function d(e){return"SPAN"==e.tagName&&e.classList.contains(h)}l.changed=new r.Signal,l=n=__decorate([a.Control.register("ga-func-editor")],l),t.FuncEditor=l})),define("graph-art",["require","exports","ga-core-ui","ga-core-ui!graph-art","ga-core-utils","graph-art","graph-art"],(function(e,t,i,a,r,s,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const h=["None","Loop","Bounce"];let o=class extends i.Control{constructor(e){super(),this.variable=e,this._expanded=!1,this._listenValue=!0,this._pixPerValue=0,this._pointerDx=0,this._handleSliderPress=e=>{this._updatePixPerValue();const t=this.variable,i=(t.value-t.min.v)*this._pixPerValue;this._pointerDx=e.clientX-i;const a=this._slider;a.setPointerCapture(e.pointerId),a.addEventListener("pointermove",this._handleSliderMove,!0),a.addEventListener("pointerup",this._handleSliderRelease,!0),a.addEventListener("pointercancel",this._handleSliderRelease,!0),n.Variable.userFocus.raise(t)},this._handleSliderMove=e=>{const t=this.variable,i=this._positionToValue(e),a=t.clampValue(i),r=t.slotValue(a);this._listenValue=!1,t.value=r,this._listenValue=!0,this._setValueInputText(r),this._setSliderPosition(a)},this._handleSliderRelease=()=>{const e=this._slider;e.removeEventListener("pointermove",this._handleSliderMove,!0),e.removeEventListener("pointerup",this._handleSliderRelease,!0),e.removeEventListener("pointercancel",this._handleSliderRelease,!0);const t=this.variable;this._setSliderPosition(t.value),n.Variable.userBlur.raise(t)},this._handleAnimateModeChange=()=>{let e=parseFloat(this._duration.value);(isNaN(e)||e<.01)&&(e=this.variable.duration,this._setDurationInputText(e));const t=h.indexOf(this._animate.selectedItem.value);this.variable.setAnimationMode(t,1e3*e)},this._handleRangeChange=()=>{const e=this.variable;e.setRange(this._parseRangePart(this._step,e.step),this._parseRangePart(this._min,e.min),this._parseRangePart(this._max,e.max)),this._updatePixPerValue(),this._setSliderPosition(e.value)},this._handleValueInputFocus=()=>{n.Variable.userFocus.raise(this.variable)},this._handleValueInputBlur=()=>{n.Variable.userBlur.raise(this.variable)},this._handleValueInputChange=()=>{const e=this.variable,t=parseFloat(this._value.value);isNaN(t)?this._setValueInputText(e.value):e.value=e.slotValue(e.clampValue(t)),this._value.blur()},this._handleValueChanged=()=>{if(this._listenValue){const e=this.variable.value;this._setValueInputText(e),this._setSliderPosition(e)}},r.throwIfNull(e,"variable")}templateCallback(){const e=this.variable;this._animate.items.value=h,this._animate.selectedItem.value=h[e.mode],this._configIcon.content.value=a.config,i.ButtonBase.clicked.watch(this._config,()=>this.configClicked()),this._label.textContent=e.name,this._updatePixPerValue(),this._setValueInputText(e.value),this._setSliderPosition(e.value),this._setDurationInputText(e.duration),this._min.value=e.min.s,this._max.value=e.max.s,this._step.value=e.step.s,this._extra.style.marginTop=-Math.ceil(this._extra.offsetHeight)+"px",this._animate.selectedItem.watch(this._handleAnimateModeChange),this._min.addEventListener("change",this._handleRangeChange,!0),this._max.addEventListener("change",this._handleRangeChange,!0),this._step.addEventListener("change",this._handleRangeChange,!0),this._value.addEventListener("blur",this._handleValueInputBlur,!0),this._value.addEventListener("focus",this._handleValueInputFocus,!0),this._value.addEventListener("change",this._handleValueInputChange,!0),this._duration.addEventListener("change",this._handleAnimateModeChange,!0),this._slider.addEventListener("pointerdown",this._handleSliderPress,!0)}connectedCallback(){super.connectedCallback(),n.Variable.valueChanged.watch(this.variable,this._handleValueChanged)}disconnectedCallback(){super.disconnectedCallback(),n.Variable.valueChanged.unwatch(this.variable,this._handleValueChanged)}configClicked(){this._expanded=!this._expanded,this.toggleAttribute("data-expanded",this._expanded)}_setDurationInputText(e){this._duration.value=(10*Math.round(e/1e4)).toString()}_setValueInputText(e){const t=Math.round(1e5*e)/1e5;this._value.value=t.toString()}_setSliderPosition(e){const t=Math.round((e-this.variable.min.v)*this._pixPerValue);this._slider.style.left=t+"px"}_updatePixPerValue(){const e=this.variable,t=this._track.getBoundingClientRect().width-this._slider.offsetWidth;this._pixPerValue=t/(e.max.v-e.min.v)}_positionToValue(e){return(e.clientX-this._pointerDx)/this._pixPerValue+this.variable.min.v}_parseRangePart(e,t){let i=s.RangePart.tryParse(e.value);return i||(i=t,e.value=i.s),i}};o=__decorate([i.Control.register("ga-variable-view")],o),t.VariableView=o})),define("graph-art",["require","exports","ga-core-ui","ga-core-utils","graph-art","graph-art"],(function(e,t,i,a,r,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});let n=class extends i.Control{constructor(e){super(),this._views=new Array,this._sortTimeout=-1,this._handleVarInserted=(e,t)=>{for(let i=0;i<t;i++){const t=new s.VariableView(this._vars[i+e]);this._views.insertAt(i+e,t)}this._queueSort()},this._handleVarRemoving=(e,t)=>{for(let i=0;i<t;i++)this.removeChild(this._views[i+e]);this._views.removeRange(e,t)},this._sortAndInsert=()=>{this._sortTimeout=-1;const e=new Array(...this._views);e.sort((e,t)=>e.variable.name.localeCompare(t.variable.name)),i.DOM.removeAll(this);for(let t=0;t<e.length;t++)this.appendChild(e[t])};const t=e.variables;this._vars=t,t.watch(this._handleVarInserted,this._handleVarRemoving)}_queueSort(){this._sortTimeout<0&&(this._sortTimeout=window.setTimeout(this._sortAndInsert,0))}};n=__decorate([i.Control.register("ga-variable-list-view"),__param(0,a.DI.one(r.VariableManager))],n),t.VariableListView=n})),!window.customElements){const e=document.createElement("div");e.style.padding="10px",e.textContent="Graph-Art is not supported by this browser. For best results use a recent version of Chrome, Firefox, or Safari.",document.body.appendChild(e)}define("graph-art",["require","exports","ga-core-ui","graph-art","graph-art"],(function(e,t,i,a,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=new a.GraphArgument("x",1,r.RangePart.tryParse("0"),r.RangePart.tryParse("0"));let n=class extends i.Control{constructor(){super(...arguments),this._listenContent=!0,this.content=new i.BindableValue(null,e=>{this._listenContent&&this.isConnected&&this._updateContent(e)}),this._handleChange=()=>{const e=this.content.value||s;let t=r.RangePart.tryParse(this._min.value);t||(t=e.min,this._min.value=e.min.s);let i=r.RangePart.tryParse(this._max.value);i||(i=e.max,this._max.value=e.max.s);let n=this._res.value,h=parseInt(n);isNaN(h)&&(h=e.resolution);const o=a.GraphArgument.clampResolution(h);if(o!=h&&(this._res.value=o.toString()),t.v>i.v){const e=i;i=t,t=e}this._listenContent=!1,this.content.value=new a.GraphArgument(e.name,o,t,i),this._listenContent=!0}}fixRangeOrder(){const e=this._min.value,t=this._max.value,i=r.RangePart.tryParse(e),a=r.RangePart.tryParse(t);i&&a&&i.v>a.v&&(this._min.value=t,this._max.value=e)}connectedCallback(){super.connectedCallback(),this._updateContent(this.content.value)}templateCallback(){this._min.addEventListener("change",this._handleChange,!0),this._max.addEventListener("change",this._handleChange,!0),this._res.addEventListener("change",this._handleChange,!0)}_updateContent(e){const t=e||s;this._min.value=t.min.s,this._max.value=t.max.s,this._res.value=t.resolution.toString(),this._label.textContent=t.name}};n=__decorate([i.Control.register("ga-graph-argument-editor")],n),t.GraphArgumentEditor=n})),define("graph-art",["require","exports","ga-core-ui","graph-art","graph-art","graph-art","graph-art"],(function(e,t,i,a,r,s,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});let h=class extends i.Control{constructor(){super(...arguments),this._graph=null,this._validatedFuncs=null,this.label="Color",this.configKey="surface",this._handleChange=()=>{r.IPropertyGroupControl.propertyChanged.raise(this)}}setObject(e){this._graph=e}validateChanges(){const e=s.ColorFuncsSurface.funcArgs,t=new n.GAReferenceValidator(e),i=this._func0.getFuncOrShowError(e,t),a=this._func1.getFuncOrShowError(e,t),r=this._func2.getFuncOrShowError(e,t);return this._validatedFuncs=i&&a&&r?[i,a,r]:null,i?a?r?null:this._func2:this._func1:this._func0}applyChanges(){this._graph.setSurface(new s.ColorFuncsSurface(this._validatedFuncs,0))}templateCallback(){this._func0.label.value="r(s,t)",this._func1.label.value="g(s,t)",this._func2.label.value="b(s,t)",a.FuncEditor.changed.watch(this._func0,this._handleChange),a.FuncEditor.changed.watch(this._func1,this._handleChange),a.FuncEditor.changed.watch(this._func2,this._handleChange);const e=this._graph.surface.functions;this._func0.setString(e[0].s),this._func1.setString(e[1].s),this._func2.setString(e[2].s)}};h=__decorate([i.Control.register("ga-graph-color-func-editor")],h),t.GraphColorFuncEditor=h})),define("graph-art",["require","exports","ga-core-ui","graph-art","graph-art","graph-art","graph-art"],(function(e,t,i,a,r,s,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const h={u:"u",v:"v"},o=["u","v"],l=["Euclidean","Spherical","Cylindrical"],c=[{minU:"-1",maxU:"1",minV:"-1",maxV:"1"},{minU:"-3.1416",maxU:"3.1416",minV:"0",maxV:"3.1416"},{minU:"-3.1416",maxU:"3.1416",minV:"-1",maxV:"1"}],u=[{name:"f",expr:"0",args:{u:"x",v:"y"}},{name:"r",expr:"1",args:{u:"t",v:"p"}},{name:"r",expr:"1",args:{u:"t",v:"z"}}],d=[{name0:"x",name1:"y",name2:"z",expr:"0"},{name0:"t",name1:"p",name2:"r",expr:"1"},{name0:"t",name1:"z",name2:"r",expr:"1"}];let _=class extends i.Control{constructor(){super(...arguments),this._funcEditors=[],this._graph=null,this._validatedFuncs=null,this._canUpdateFuncEditors=!1,this.label="Function",this.configKey="function",this._tryUpdateFuncEditors=()=>{this._canUpdateFuncEditors&&(this._updateFuncEditors(),this._handleChange())},this.selectedMode=new i.BindableValue(l[0],this._tryUpdateFuncEditors),this.parametric=new i.BindableValue(!1,this._tryUpdateFuncEditors),this._handleChange=()=>{r.IPropertyGroupControl.propertyChanged.raise(this)}}setObject(e){this._graph=e}validateChanges(){return this.parametric.value?this._validateMultiFunc():this._validateSingleFunc(this._getSelectedMode())}applyChanges(){this._var0.fixRangeOrder(),this._var1.fixRangeOrder();const e=this._getSelectedMode(),t=[this._var0.content.value,this._var1.content.value];this._graph.setFunctions(t,this._validatedFuncs,e)}templateCallback(){const e=this._graph.functions.length;this._canUpdateFuncEditors=!1,this.selectedMode.value=l[this._graph.mode],this.parametric.value=e>1,this._canUpdateFuncEditors=!0,this._updateFuncEditors(),this._graph.arguments.length>0&&(this._var0.content.value=this._graph.arguments[0],this._var1.content.value=this._graph.arguments[1]);for(let t=0;t<e;t++)this._funcEditors[t].setString(this._graph.functions[t].s);this._var0.content.watch(this._handleChange),this._var1.content.watch(this._handleChange),this._mode.items.value=l,this._mode.selectedItem.value=this.selectedMode.value,this._mode.selectedItem.watch(()=>this.selectedMode.value=this._mode.selectedItem.value),this._para.content.value="Parametric",this._para.checked.value=this.parametric.value,this._para.checked.watch(()=>this.parametric.value=this._para.checked.value)}_validateMultiFunc(){const e=o,t=new s.GAReferenceValidator(e),i=this._funcEditors[0].getFuncOrShowError(e,t),a=this._funcEditors[1].getFuncOrShowError(e,t),r=this._funcEditors[2].getFuncOrShowError(e,t);return this._validatedFuncs=i&&a&&r?[i,a,r]:null,i?a?r?null:this._funcEditors[2]:this._funcEditors[1]:this._funcEditors[0]}_validateSingleFunc(e){const t=u[e],i=[t.args.u,t.args.v],a=new s.GAReferenceValidator(i),r=this._funcEditors[0].getFuncOrShowError(i,a);return this._validatedFuncs=r?[r]:null,r?null:this._funcEditors[0]}_updateFuncEditors(){let e,t=l.indexOf(this.selectedMode.value);if(i.DOM.removeAll(this._funcs),this._funcEditors.length=0,this.parametric.value){const i=d[t];e=h,this._addFuncEditor(i.name0,e,e.u),this._addFuncEditor(i.name1,e,e.v),this._addFuncEditor(i.name2,e,i.expr)}else{const i=u[t];e=i.args,this._addFuncEditor(i.name,e,i.expr)}const a=c[t];this._var0.content.value=n.GraphArgument.parseOrDefault(e.u,50,a.minU,a.maxU),this._var1.content.value=n.GraphArgument.parseOrDefault(e.v,50,a.minV,a.maxV)}_addFuncEditor(e,t,i){const r=new a.FuncEditor;r.label.value=`${e}(${t.u},${t.v})`,r.setString(i),this._funcEditors.push(r),this._funcs.appendChild(r),a.FuncEditor.changed.watch(r,this._handleChange)}_getSelectedMode(){return l.indexOf(this.selectedMode.value)}};_=__decorate([i.Control.register("ga-graph-function-editor")],_),t.GraphFunctionEditor=_})),define("graph-art",["require","exports","ga-core-utils","graph-art","graph-art","graph-art","graph-art"],(function(e,t,i,a,r,s,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),i.DI.services.addProvider(s.PropertyPanel,s.PropertyPanel.createProvider(r.Graph.viewKey,0,[n.GraphFunctionEditor,a.GraphColorFuncEditor]))})),define("graph-art",["require","exports","graph-art"],(function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class a extends i.GAObject{constructor(e){super(),this.directional=e,this.r=.8,this.g=.8,this.b=.8,this.x=1,this.y=0,this.z=0}get viewKey(){return a.viewKey}setColor(e,t,i){this.r=e,this.g=t,this.b=i}setDirection(e,t,i){const a=Math.sqrt(e*e+t*t+i*i);this.x=e/a,this.y=t/a,this.z=i/a}}a.viewKey="light",t.Light=a})),define("graph-art",["require","exports","ga-core-utils","graph-art"],(function(e,t,i,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});let r=class{constructor(){this.ambientLight=new a.Light(!0),this.lights=new i.SignalingArray,this.ambientLight.setColor(.2,.2,.2);const e=new a.Light(!0);e.label="Light #1",e.setDirection(.25,.25,1),e.setColor(.8,.8,.8),this.lights.push(e)}};r=__decorate([i.DI.singleton()],r),t.LightingManager=r})),define("graph-art",["require","exports","graph-art"],(function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class a extends i.GAObject{get viewKey(){return a.viewKey}}a.viewKey="point",t.Point=a})),define("graph-art",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=1e-8;class a{static toInverseTransposeMat3(e,t){const a=t[0],r=t[1],s=t[2],n=t[3],h=t[4],o=t[5],l=t[6],c=t[7],u=t[8],d=t[9],_=t[10],p=t[11],g=t[12],v=t[13],m=t[14],f=t[15],b=a*o-r*h,w=a*l-s*h,x=a*c-n*h,P=r*l-s*o,y=r*c-n*o,C=s*c-n*l,V=u*v-d*g,A=u*m-_*g,M=u*f-p*g,E=d*m-_*v,S=d*f-p*v,R=_*f-p*m;let F=b*R-w*S+x*E+P*M-y*A+C*V;Math.abs(F)<i||(e[0]=(o*R-l*S+c*E)/F,e[1]=(l*M-h*R-c*A)/F,e[2]=(h*S-o*M+c*V)/F,e[3]=(s*S-r*R-n*E)/F,e[4]=(a*R-s*M+n*A)/F,e[5]=(r*M-a*S-n*V)/F,e[6]=(v*C-m*y+f*P)/F,e[7]=(m*x-g*C-f*w)/F,e[8]=(g*y-v*x+f*b)/F)}static perspective(e,t,i,a,r){const s=1/Math.tan(t/2),n=1/(a-r);e[0]=s/i,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=s,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=(r+a)*n,e[11]=-1,e[12]=0,e[13]=0,e[14]=2*r*a*n,e[15]=0}static lookAt(e,t,r,s){let n=0,h=0,o=0,l=0,c=0,u=0,d=0,_=0,p=0,g=0;const v=t[0],m=t[1],f=t[2],b=s[0],w=s[1],x=s[2],P=r[0],y=r[1],C=r[2];Math.abs(v-P)<i&&Math.abs(m-y)<i&&Math.abs(f-C)<i?a.identity(e):(d=v-P,_=m-y,p=f-C,g=1/Math.sqrt(d*d+_*_+p*p),d*=g,_*=g,p*=g,n=w*p-x*_,h=x*d-b*p,o=b*_-w*d,g=Math.sqrt(n*n+h*h+o*o),g?(g=1/g,n*=g,h*=g,o*=g):(n=0,h=0,o=0),l=_*o-p*h,c=p*n-d*o,u=d*h-_*n,g=Math.sqrt(l*l+c*c+u*u),g<i?(l=0,c=0,u=0):(g=1/g,l*=g,c*=g,u*=g),e[0]=n,e[1]=l,e[2]=d,e[3]=0,e[4]=h,e[5]=c,e[6]=_,e[7]=0,e[8]=o,e[9]=u,e[10]=p,e[11]=0,e[12]=-(n*v+h*m+o*f),e[13]=-(l*v+c*m+u*f),e[14]=-(d*v+_*m+p*f),e[15]=1)}static rotate(e,t,a,r,s){let n=Math.sqrt(a*a+r*r+s*s);if(n<i)return;n=1/n,a*=n,r*=n,s*=n;const h=Math.sin(t),o=Math.cos(t),l=1-o,c=e[0],u=e[1],d=e[2],_=e[3],p=e[4],g=e[5],v=e[6],m=e[7],f=e[8],b=e[9],w=e[10],x=e[11],P=a*a*l+o,y=r*a*l+s*h,C=s*a*l-r*h;e[0]=c*P+p*y+f*C,e[1]=u*P+g*y+b*C,e[2]=d*P+v*y+w*C,e[3]=_*P+m*y+x*C;const V=a*r*l-s*h,A=r*r*l+o,M=s*r*l+a*h;e[4]=c*V+p*A+f*M,e[5]=u*V+g*A+b*M,e[6]=d*V+v*A+w*M,e[7]=_*V+m*A+x*M;const E=a*s*l+r*h,S=r*s*l-a*h,R=s*s*l+o;e[8]=c*E+p*S+f*R,e[9]=u*E+g*S+b*R,e[10]=d*E+v*S+w*R,e[11]=_*E+m*S+x*R}static transform(e,t){const i=e[0],a=e[1],r=e[2],s=e[3],n=e[4],h=e[5],o=e[6],l=e[7],c=e[8],u=e[9],d=e[10],_=e[11],p=e[12],g=e[13],v=e[14],m=e[15];let f=t[0],b=t[1],w=t[2],x=t[3];e[0]=f*i+b*n+w*c+x*p,e[1]=f*a+b*h+w*u+x*g,e[2]=f*r+b*o+w*d+x*v,e[3]=f*s+b*l+w*_+x*m,f=t[4],b=t[5],w=t[6],x=t[7],e[4]=f*i+b*n+w*c+x*p,e[5]=f*a+b*h+w*u+x*g,e[6]=f*r+b*o+w*d+x*v,e[7]=f*s+b*l+w*_+x*m,f=t[8],b=t[9],w=t[10],x=t[11],e[8]=f*i+b*n+w*c+x*p,e[9]=f*a+b*h+w*u+x*g,e[10]=f*r+b*o+w*d+x*v,e[11]=f*s+b*l+w*_+x*m,f=t[12],b=t[13],w=t[14],x=t[15],e[12]=f*i+b*n+w*c+x*p,e[13]=f*a+b*h+w*u+x*g,e[14]=f*r+b*o+w*d+x*v,e[15]=f*s+b*l+w*_+x*m}static translate(e,t,i,a){e[12]+=t*e[0]+i*e[4]+a*e[8],e[13]+=t*e[1]+i*e[5]+a*e[9],e[14]+=t*e[2]+i*e[6]+a*e[10],e[15]+=t*e[3]+i*e[7]+a*e[11]}static scale(e,t,i,a){e[0]*=t,e[1]*=t,e[2]*=t,e[3]*=t,e[4]*=i,e[5]*=i,e[6]*=i,e[7]*=i,e[8]*=a,e[9]*=a,e[10]*=a,e[11]*=a}static copy(e,t){e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]}static identity(e){e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1}}t.Mtx4=a})),define("graph-art",["require","exports","graph-art"],(function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class a{constructor(e,t,i){this.gl=e,this._basePjMatrix=t,this._baseMvMatrix=i,this._mvProjMatrix=new Float32Array(16),this._mvInvtMatrix=new Float32Array(9),this._mvMatrix=new Float32Array(16),this._mvStack=new Array(this._mvMatrix),this._mvDepth=0,this._mvInvtDirty=!0,this._mvProjDirty=!0}modelViewProjToUniform4fv(e){this._mvProjDirty&&(this._mvProjDirty=!1,i.Mtx4.copy(this._mvProjMatrix,this._basePjMatrix),i.Mtx4.transform(this._mvProjMatrix,this._mvMatrix)),this.gl.uniformMatrix4fv(e,!1,this._mvProjMatrix)}modelViewInvtToUniform3fv(e){this._mvInvtDirty&&(this._mvInvtDirty=!1,i.Mtx4.toInverseTransposeMat3(this._mvInvtMatrix,this._mvMatrix)),this.gl.uniformMatrix3fv(e,!1,this._mvInvtMatrix)}saveMatrix(){this._mvDepth++,this._mvStack.length==this._mvDepth&&this._mvStack.push(new Float32Array(16));const e=this._mvStack[this._mvDepth];i.Mtx4.copy(e,this._mvMatrix),this._mvMatrix=e}restoreMatrix(){this._mvDepth>0?(this._mvProjDirty=!0,this._mvInvtDirty=!0,this._mvMatrix=this._mvStack[--this._mvDepth]):console.warn("WglRenderState save/restore mismatch")}rotate(e,t,a,r){this._mvProjDirty=!0,this._mvInvtDirty=!0,i.Mtx4.rotate(this._mvMatrix,e,t,a,r)}translate(e,t,a){this._mvProjDirty=!0,this._mvInvtDirty=!0,i.Mtx4.translate(this._mvMatrix,e,t,a)}scale(e,t,a){this._mvProjDirty=!0,this._mvInvtDirty=!0,i.Mtx4.scale(this._mvMatrix,e,t,a)}transform(e){this._mvProjDirty=!0,this._mvInvtDirty=!0,i.Mtx4.transform(this._mvMatrix,e)}setMatrix(e){this._mvProjDirty=!0,this._mvInvtDirty=!0,i.Mtx4.copy(this._mvMatrix,e)}_reset(){this._mvDepth>0&&console.warn("Resetting WglRenderState from an unclean state"),this._mvDepth=0,this._mvMatrix=this._mvStack[0],this._mvInvtDirty=!0,this._mvProjDirty=!0,i.Mtx4.copy(this._mvMatrix,this._baseMvMatrix)}}t.WglContainer=class{constructor(e){this._canvas=e,this._camera=new Float32Array([0,0,0]),this._lookAt=new Float32Array([0,0,1]),this._upward=new Float32Array([0,1,0]),this._baseMvMatrix=new Float32Array(16),this._basePjMatrix=new Float32Array(16),this._viewPortW=1,this._viewPortH=1,this._fovRadians=Math.PI/4,this._nearDist=.1,this._farDist=100,this._viewDirty=!1,this._projDirty=!1;const t=e.getContext("webgl");i.Mtx4.identity(this._basePjMatrix),i.Mtx4.identity(this._baseMvMatrix),t.clearColor(0,0,0,1),t.enable(t.DEPTH_TEST),this.state=new a(t,this._basePjMatrix,this._baseMvMatrix),this.updateViewportSize()}updateViewportSize(){this._projDirty=!0,this._viewPortW=this._canvas.offsetWidth,this._viewPortH=this._canvas.offsetHeight,this._canvas.width=this._viewPortW,this._canvas.height=this._viewPortH}setPerspective(e,t,i){this._fovRadians=e,this._nearDist=t,this._farDist=i,this._projDirty=!0}setCameraPosition(e,t,i){this._camera[0]=e,this._camera[1]=t,this._camera[2]=i,this._viewDirty=!0}setLookAtPosition(e,t,i){this._lookAt[0]=e,this._lookAt[1]=t,this._lookAt[2]=i,this._viewDirty=!0}setUpwardVector(e,t,i){this._upward[0]=e,this._upward[1]=t,this._upward[2]=i,this._viewDirty=!0}beginRenderFrame(){const e=this.state,t=e.gl;this._projDirty&&(this._projDirty=!1,i.Mtx4.perspective(this._basePjMatrix,this._fovRadians,this._viewPortW/this._viewPortH,this._nearDist,this._farDist),t.viewport(0,0,this._viewPortW,this._viewPortH)),this._viewDirty&&(this._viewDirty=!1,i.Mtx4.lookAt(this._baseMvMatrix,this._camera,this._lookAt,this._upward)),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT),e._reset()}}})),define("graph-art",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.GaglObjectView=class{}})),define("graph-art",["require","exports","ga-core-utils"],(function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class a{constructor(e){this._args=e,this._buffer=[]}static write(e){i.throwIfNull(e,"func");const t=new a(e.arguments);return e.ast.accept(t),t._buffer.join("")}visitConstant(e){this._buffer.push(Number.isInteger(e.value)?e.value.toFixed(1):e.value.toString())}visitNegate(e){this._buffer.push("(-"),e.value.accept(this),this._buffer.push(")")}visitBinary(e){this._buffer.push("("),e.lhs.accept(this),this._buffer.push(e.operator),e.rhs.accept(this),this._buffer.push(")")}visitVariableRef(e){const t=this._buffer,i=this._args.indexOf(e.name);i>=0?(t.push("_arg"),t.push(i.toString())):/pi/i.test(e.name)?t.push(Math.PI.toString()):(t.push("v_"),t.push(e.name))}visitFunctionRef(e){this._buffer.push(e.name),this._buffer.push("(");for(let t=0;t<e.args.length;t++)t>0&&this._buffer.push(","),e.args[t].accept(this);this._buffer.push(")")}}t.WglFuncToShader=a})),define("graph-art",["require","exports","ga-core-ast","graph-art","graph-art"],(function(e,t,i,a,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=new a.GAFunc("u",new i.VariableRef("u"),["u","v"]),n=new a.GAFunc("v",new i.VariableRef("v"),["u","v"]);function h(e,t){return e.length>t?r.WglFuncToShader.write(e[t]):"0.8"}t.WglShaderBuilder=class{constructor(){this._s=new Array}addVariableDecls(e){for(let t=0,i=e.length;t<i;t++)this.add(`uniform float v_${e[t].name};`)}addDefaultBaseColor(){this.add("vec3 baseColor = vec3(0.1, 0.1, 0.8);")}addColorFuncsSurfaceBaseColor(e){const t=h(e.functions,0),i=h(e.functions,1),a=h(e.functions,2);this.add("float _arg0 = vTexturePos.x;"),this.add("float _arg1 = vTexturePos.y;"),this.add(`vec3 baseColor = vec3(${t},${i},${a});`)}addGraphFunctions(e){let t,i,a;const r=e.functions;switch(1==r.length?(t=s,i=n,a=r[0]):(t=r[0],i=r[1],a=r[2]),e.mode){case 1:this.addVec4WithFunc("t",t),this.addVec4WithFunc("p",i),this.addVec4WithFunc("r",a),this.addVec4("x","r * cos(t) * sin(p)"),this.addVec4("y","r * sin(t) * sin(p)"),this.addVec4("z","r *          cos(p)");break;case 2:this.addVec4WithFunc("t",t),this.addVec4WithFunc("r",a),this.addVec4WithFunc("z",i),this.addVec4("x","r * sin(t)"),this.addVec4("y","r * cos(t)");break;default:this.addVec4WithFunc("x",t),this.addVec4WithFunc("y",i),this.addVec4WithFunc("z",a)}}addVec4WithFunc(e,t){const i=r.WglFuncToShader.write(t);for(let a=0,r=t.arguments.length;a<r;a++)if(t.variables.has(t.arguments[a]))return void this._s.push(`vec4 ${e} = ${i};`);this._s.push(`vec4 ${e} = vec4(${i});`)}addVec4(e,t){this._s.push(`vec4 ${e} = ${t};`)}add(e){this._s.push(e)}compile(e,t){const i=this._s.join("\n"),a=e.createShader(t);if(e.shaderSource(a,i),e.compileShader(a),!e.getShaderParameter(a,e.COMPILE_STATUS)){const t=e.getShaderInfoLog(a);throw new Error(`Could not compile shader: ${t}`)}return a}}})),define("graph-art",["require","exports","graph-art","graph-art","graph-art"],(function(e,t,i,a,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class s extends a.GaglObjectView{constructor(e,t){super(),this._graph=e,this._owner=t,this._shaderProgram=null,this._vertexBuffer=null,this._texPosBuffer=null,this._vertexCount=-1,this._vertexAttrib=-1,this._texPosAttrib=-1,this._canRender=!1,this._dirty=!0,this._modelViewProjLoc=null,this._modelViewInvtLoc=null,this._ambientLightLoc=null,this._samplerLocation=null,this._lightCoordLocs=new Array,this._lightColorLocs=new Array,this._variableLocs=new Array,this._variableRefs=new Array,this._handleGraphChanged=()=>{this._dirty=this._canRender=this._graph.functions.length>0,this._owner.queueRender()},this._handleGraphChanged(),i.Graph.changed.watch(this._graph,this._handleGraphChanged)}cleanup(){this._cleanupWebGl(this._owner.glContext),i.Graph.changed.unwatch(this._graph,this._handleGraphChanged)}render(e){if(!this._canRender)return;this._dirty&&(this._dirty=!1,this._applyChanges());const t=e.gl;t.useProgram(this._shaderProgram);const i=this._owner.lighting.ambientLight;t.uniform3f(this._ambientLightLoc,i.r,i.g,i.b);const a=this._owner.lighting.lights;for(let e=0,i=a.length;e<i;e++){const i=a[e];t.uniform3f(this._lightCoordLocs[e],i.x,i.y,i.z),t.uniform3f(this._lightColorLocs[e],i.r,i.g,i.b)}for(let e=0,i=this._variableRefs.length;e<i;e++)t.uniform1f(this._variableLocs[e],this._variableRefs[e].value);e.modelViewProjToUniform4fv(this._modelViewProjLoc),e.modelViewInvtToUniform3fv(this._modelViewInvtLoc),t.enableVertexAttribArray(this._vertexAttrib),t.enableVertexAttribArray(this._texPosAttrib),t.bindBuffer(t.ARRAY_BUFFER,this._vertexBuffer),t.vertexAttribPointer(this._vertexAttrib,3,t.FLOAT,!1,0,0),t.bindBuffer(t.ARRAY_BUFFER,this._texPosBuffer),t.vertexAttribPointer(this._texPosAttrib,2,t.FLOAT,!1,0,0),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,this._owner.texture1),t.drawArrays(t.TRIANGLES,0,this._vertexCount),t.disableVertexAttribArray(this._vertexAttrib),t.disableVertexAttribArray(this._texPosAttrib)}_applyChanges(){const e=this._owner.glContext;this._cleanupWebGl(e),this._initProgram(e),this._initBuffer(e)}_initProgram(e){this._lightCoordLocs.length=0,this._lightColorLocs.length=0;const t=function(e,t,i){const a=new r.WglShaderBuilder;a.add("precision mediump float;"),a.add("attribute vec3 vertexPos;"),a.add("attribute vec2 texturePos;"),a.add("uniform mat4 modelViewProj;"),a.add("uniform mat3 modelViewInvT;"),a.add("uniform vec3 ambientLightColor;"),a.add("varying vec3 vLightWeighting;"),a.add("varying vec2 vTexturePos;");for(let e=0,t=i.length;e<t;e++)a.add(`uniform vec3 lightCoord${e};`),a.add(`uniform vec3 lightColor${e};`);a.addVariableDecls(t.variables),a.add("void main(void) {"),a.add("vec4 _arg0 = vec4(vertexPos.x, vertexPos.x-.01, vertexPos.x-.01, vertexPos.x+.01);"),a.add("vec4 _arg1 = vec4(vertexPos.y, vertexPos.y+.01, vertexPos.y-.01, vertexPos.y);"),a.addGraphFunctions(t),a.add("vec3 line1 = vec3(x[1] - x[0], y[1] - y[0], z[1] - z[0]);"),a.add("vec3 line2 = vec3(x[2] - x[0], y[2] - y[0], z[2] - z[0]);"),a.add("vec3 transformedNormal = modelViewInvT * normalize(cross(line1, line2));"),a.add("gl_Position = modelViewProj * vec4(x[0], y[0], z[0], 1.0);"),a.add("vTexturePos = texturePos;"),a.add("vLightWeighting = ambientLightColor;");for(let e=0;e<i.length;e++)i[e].directional&&a.add(`vLightWeighting += lightColor${e}*abs(dot(transformedNormal, lightCoord${e}));`);return a.add("}"),a.compile(e,e.VERTEX_SHADER)}(e,this._graph,this._owner.lighting.lights),i=function(e,t){const i=new r.WglShaderBuilder;t.surface;return i.add("precision mediump float;"),i.add("uniform sampler2D textureSampler;"),i.add("varying vec3 vLightWeighting;"),i.add("varying vec2 vTexturePos;"),i.addVariableDecls(t.surface.variables),i.add("void main(void) {"),i.add("vec4 baseColor = texture2D(textureSampler, vTexturePos.st);"),i.add("gl_FragColor = vec4(baseColor.rgb*vLightWeighting, baseColor.a);"),i.add("}"),i.compile(e,e.FRAGMENT_SHADER)}(e,this._graph),a=this._shaderProgram=e.createProgram();if(e.attachShader(a,t),e.attachShader(a,i),e.linkProgram(a),!e.getProgramParameter(a,e.LINK_STATUS))throw new Error("Could not initialize shader program");e.useProgram(a),this._vertexAttrib=e.getAttribLocation(a,"vertexPos"),this._texPosAttrib=e.getAttribLocation(a,"texturePos"),this._ambientLightLoc=e.getUniformLocation(a,"ambientLightColor"),this._samplerLocation=e.getUniformLocation(a,"textureSampler"),this._modelViewProjLoc=e.getUniformLocation(a,"modelViewProj"),this._modelViewInvtLoc=e.getUniformLocation(a,"modelViewInvT");for(let t=0,i=this._owner.lighting.lights.length;t<i;t++)this._lightCoordLocs.push(e.getUniformLocation(a,`lightCoord${t}`)),this._lightColorLocs.push(e.getUniformLocation(a,`lightColor${t}`));this._variableLocs.length=0,this._variableRefs.length=0,this._addVariableUniformLocs(e,this._graph.variables),this._addVariableUniformLocs(e,this._graph.surface.variables)}_initBuffer(e){const t=this._graph.arguments[0],i=this._graph.arguments[1];let a=t.min.v,r=i.min.v,s=t.resolution,n=i.resolution,h=(t.max.v-a)/s,o=(i.max.v-r)/n;const l=s*n*6,c=new Float32Array(3*l),u=new Float32Array(2*l);let d=0,_=0;for(let e=0;e<n;e++)for(let t=0;t<s;t++){const i=(t+0)*h+a,l=(e+0)*o+r,p=(t+1)*h+a,g=(e+1)*o+r;c[d++]=p,c[d++]=g,c[d++]=0,c[d++]=i,c[d++]=g,c[d++]=0,c[d++]=i,c[d++]=l,c[d++]=0,c[d++]=p,c[d++]=g,c[d++]=0,c[d++]=i,c[d++]=l,c[d++]=0,c[d++]=p,c[d++]=l,c[d++]=0;const v=(t+0)/s*5%1,m=(e+0)/n*5%1;let f=(t+1)/s*5%1,b=(e+1)/n*5%1;0==f&&(f=1),0==b&&(b=1),u[_++]=f,u[_++]=b,u[_++]=v,u[_++]=b,u[_++]=v,u[_++]=m,u[_++]=f,u[_++]=b,u[_++]=v,u[_++]=m,u[_++]=f,u[_++]=m}this._vertexCount=l,this._vertexBuffer=e.createBuffer(),this._texPosBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this._vertexBuffer),e.bufferData(e.ARRAY_BUFFER,c,e.STATIC_DRAW),e.bindBuffer(e.ARRAY_BUFFER,this._texPosBuffer),e.bufferData(e.ARRAY_BUFFER,u,e.STATIC_DRAW)}_cleanupWebGl(e){e.deleteBuffer(this._vertexBuffer),e.deleteBuffer(this._texPosBuffer),e.deleteProgram(this._shaderProgram),this._vertexBuffer=null,this._texPosBuffer=null,this._shaderProgram=null}_addVariableUniformLocs(e,t){for(let i=0,a=t.length;i<a;i++){const a=t[i];if(this._variableRefs.indexOf(a)<0){const t=e.getUniformLocation(this._shaderProgram,`v_${a.name}`);this._variableLocs.push(t),this._variableRefs.push(a)}}}}t.GaglGraphView=s})),define("graph-art",["require","exports","graph-art"],(function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class a extends i.GaglObjectView{constructor(e,t){super(),this._light=e,this._owner=t}cleanup(){}render(e){}}t.GaglLightView=a})),define("graph-art",["require","exports","graph-art"],(function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class a extends i.GaglObjectView{constructor(e,t){super(),this._point=e,this._owner=t}cleanup(){}render(e){}}t.GaglPointView=a})),define("graph-art",["require","exports","ga-core-utils"],(function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=1/90*Math.PI,r=1.04,s=1/1.04;function n(e){return e%(2*Math.PI)+(e<0?2*Math.PI:0)}function h(e){return Math.min(Math.max(e,-Math.PI/2),Math.PI/2)}function o(e){e.stopPropagation(),e.preventDefault()}t.ViewInputHandler=class{constructor(e,t){this._element=e,this._view=t,this._invertXY=!1,this._initialPtrX=0,this._initialPtrY=0,this._initialCamXY=0,this._initialCamYZ=0,this._handlePointerDown=e=>{const t=this._element,i=t.getBoundingClientRect(),a=e.clientY>i.top+i.height/2,r=this._view.cameraYZ<0;this._invertXY=r!=a,this._initialPtrX=e.clientX,this._initialPtrY=e.clientY,this._initialCamXY=this._view.cameraXY,this._initialCamYZ=this._view.cameraYZ,t.setPointerCapture(e.pointerId),t.addEventListener("pointermove",this._handlePointerMove,!0),t.addEventListener("pointerup",this._handlePointerUp,!0),o(e)},this._handlePointerMove=e=>{const t=Math.PI,i=this._element,a=(e.clientX-this._initialPtrX)*(this._invertXY?-1:1),r=e.clientY-this._initialPtrY;this._view.setCameraPosition(this._view.cameraDistance,n(this._initialCamXY+t*a/i.offsetWidth),h(this._initialCamYZ+t*r/i.offsetHeight)),o(e)},this._handlePointerUp=e=>{const t=this._element;t.removeEventListener("pointerup",this._handlePointerUp,!0),t.removeEventListener("pointermove",this._handlePointerMove,!0),o(e)},this._handleScrollWheel=e=>{const t=this._view;t.setCameraPosition(t.cameraDistance*(e.deltaY<0?s:r),t.cameraXY,t.cameraYZ)},this._handleKeyDown=e=>{let t=this._view,i=t.cameraDistance,o=t.cameraXY,l=t.cameraYZ;switch(e.key){case"PageUp":i*=s;break;case"PageDown":i*=r;break;case"ArrowRight":o=n(o-a);break;case"ArrowLeft":o=n(o+a);break;case"ArrowUp":l=h(l-a);break;case"ArrowDown":l=h(l+a);break;default:return}t.setCameraPosition(i,o,l)},i.throwIfNull(e,"element"),e.addEventListener("keydown",this._handleKeyDown,!0),e.addEventListener("wheel",this._handleScrollWheel,!0),e.addEventListener("pointerdown",this._handlePointerDown,!0)}}})),define("graph-art",["require","exports","ga-core-ui","ga-core-utils","graph-art","graph-art","graph-art","graph-art","graph-art","graph-art","graph-art","graph-art","graph-art","graph-art","graph-art","graph-art","graph-art"],(function(e,t,i,a,r,s,n,h,o,l,c,u,d,_,p,g,v){"use strict";Object.defineProperty(t,"__esModule",{value:!0});let m=class extends i.Control{constructor(e,t,i,a){super(),this._view=t,this._lighting=i,this._variables=a,this.texture1=null,this._axesView=new u.GaglAxesView(this),this._objectViews=new Array,this._lightViews=new Array,this._frameTimer=-1,this._handleVarValueChanged=()=>{this.queueRender()},this._handleCameraMoved=()=>{this._updateCameraPosition(this._view),this.queueRender()},this._handleLightsInserted=(e,t)=>{for(let i=0;i<t;i++)this._lightViews.push(new _.GaglLightView(this._lighting.lights[i+e],this));this.queueRender()},this._handleLightsRemoving=(e,t)=>{for(let i=t;i>=0;i--){const t=this._lightViews[i+e];this._lightViews.removeAt(i+e),t.cleanup()}this.queueRender()},this._handleObjectInserted=(e,t)=>{const i=this._createObjectView(e.get(t));this._objectViews.insertAt(t,i),this.queueRender()},this._handleObjectRemoving=(e,t)=>{const i=this._objectViews[t];this._objectViews.removeAt(t),this.queueRender(),i.cleanup()},this._handleIsPlayingChanged=()=>{this._variables.isPlaying.value&&this.queueRender()},this._handleWindowResize=()=>{this._wglContainer.updateViewportSize(),this.queueRender()},this._updateFrame=()=>{this._wglContainer.beginRenderFrame(),this._variables.updateValuesForPlayback();const e=this._wglContainer.state;e.saveMatrix(),f(e,this._objectViews),f(e,this._lightViews),e.restoreMatrix(),this._axesView.render(e),this._frameTimer=this._variables.isPlaying.value?requestAnimationFrame(this._updateFrame):-1},this._canvas=document.createElement("canvas"),this._glContext=this._canvas.getContext("webgl");const r=this._wglContainer=new v.WglContainer(this._canvas);r.setUpwardVector(0,0,1),r.setLookAtPosition(0,0,0),r.setPerspective(Math.PI/4,.1,100);const s=this._glContext;s.enable(s.BLEND),s.blendFunc(s.SRC_ALPHA,s.ONE_MINUS_SRC_ALPHA),this.texture1=s.createTexture();const h=new Image;h.onload=()=>{s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,!0),s.bindTexture(s.TEXTURE_2D,this.texture1),s.texImage2D(s.TEXTURE_2D,0,s.RGBA,s.RGBA,s.UNSIGNED_BYTE,h),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,s.LINEAR),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,s.LINEAR_MIPMAP_LINEAR),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,s.CLAMP_TO_EDGE),s.generateMipmap(s.TEXTURE_2D),s.bindTexture(s.TEXTURE_2D,null)},h.src="pats/hex2-transparent.png",new g.ViewInputHandler(this,t),this._updateCameraPosition(t),n.ObjectGroup.inserted.watch(e,this._handleObjectInserted),n.ObjectGroup.removing.watch(e,this._handleObjectRemoving),c.ViewManager.cameraMoved.watch(this._view,this._handleCameraMoved),this._variables.isPlaying.watch(this._handleIsPlayingChanged),this._lighting.lights.watch(this._handleLightsInserted,this._handleLightsRemoving)}get glContext(){return this._glContext}get lighting(){return this._lighting}queueRender(){this._frameTimer<0&&(this._frameTimer=requestAnimationFrame(this._updateFrame))}initializeCallback(){this.appendChild(this._canvas);const e=this._canvas.style;e.position="absolute",e.width="100%",e.height="100%"}connectedCallback(){super.connectedCallback(),this._handleWindowResize(),this._updateFrame(),window.addEventListener("resize",this._handleWindowResize),o.Variable.valueChanged.watchAnySender(this._handleVarValueChanged)}disconnectedCallback(){super.disconnectedCallback(),window.removeEventListener("resize",this._handleWindowResize),o.Variable.valueChanged.unwatchAnySender(this._handleVarValueChanged)}_updateCameraPosition(e){const t=e.cameraDistance,i=e.cameraXY,a=e.cameraYZ,r=t*Math.cos(a),s=t*Math.sin(a);this._wglContainer.setCameraPosition(r*Math.cos(i),r*Math.sin(i),s)}_createObjectView(e){if(e instanceof r.Graph)return new d.GaglGraphView(e,this);if(e instanceof h.Point)return new p.GaglPointView(e,this);throw new Error("Unknown object type")}};function f(e,t){for(let i=0,a=t.length;i<a;i++)t[i].render(e)}m=__decorate([i.Control.register("ga-gl-control"),__param(0,a.DI.one(n.ObjectGroup,n.ObjectGroup.rootKey)),__param(1,a.DI.one(c.ViewManager)),__param(2,a.DI.one(s.LightingManager)),__param(3,a.DI.one(l.VariableManager))],m),t.GaglControl=m})),define("graph-art",["require","exports","graph-art","graph-art"],(function(e,t,i,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class r extends i.GaglObjectView{constructor(e){super(),this._owner=e,this._dirty=!0,this._vertexCount=-1,this._vertexCount2=-1,this._vertexAttrib=-1,this._vertexBuffer=null,this._vertexBuffer2=null,this._shaderProgram=null,this._modelViewProjLoc=null}cleanup(){this._cleanupWebGl(this._owner.glContext)}render(e){const t=e.gl;this._dirty&&(this._dirty=!1,this._applyChanges(t)),t.lineWidth(5),t.useProgram(this._shaderProgram),e.modelViewProjToUniform4fv(this._modelViewProjLoc),t.enableVertexAttribArray(this._vertexAttrib),t.bindBuffer(t.ARRAY_BUFFER,this._vertexBuffer),t.vertexAttribPointer(this._vertexAttrib,3,t.FLOAT,!1,0,0),t.drawArrays(t.LINES,0,this._vertexCount),t.bindBuffer(t.ARRAY_BUFFER,this._vertexBuffer2),t.vertexAttribPointer(this._vertexAttrib,3,t.FLOAT,!1,0,0),t.drawArrays(t.POINTS,0,this._vertexCount2),t.disableVertexAttribArray(this._vertexAttrib)}_applyChanges(e){const t=function(e){const t=new a.WglShaderBuilder;return t.add("precision mediump float;"),t.add("attribute vec3 vertexPos;"),t.add("uniform mat4 modelViewProj;"),t.add("void main(void) {"),t.add("gl_Position = modelViewProj * vec4(vertexPos, 1.0);"),t.add("gl_PointSize = 5.0;"),t.add("}"),t.compile(e,e.VERTEX_SHADER)}(e),i=function(e){const t=new a.WglShaderBuilder;return t.add("precision mediump float;"),t.add("void main(void) {"),t.add("gl_FragColor = vec4(0.0, 1.0, 0.0, 1.0);"),t.add("}"),t.compile(e,e.FRAGMENT_SHADER)}(e),r=this._shaderProgram=e.createProgram();if(e.attachShader(r,t),e.attachShader(r,i),e.linkProgram(r),!e.getProgramParameter(r,e.LINK_STATUS))throw new Error("Could not initialize shader program");e.useProgram(r),this._vertexAttrib=e.getAttribLocation(r,"vertexPos"),this._modelViewProjLoc=e.getUniformLocation(r,"modelViewProj");const s=new Float32Array(18);s[0]=-2,s[1]=0,s[2]=0,s[3]=2,s[4]=0,s[5]=0,s[6]=0,s[7]=-2,s[8]=0,s[9]=0,s[10]=2,s[11]=0,s[12]=0,s[13]=0,s[14]=-2,s[15]=0,s[16]=0,s[17]=2,this._vertexCount=6,this._vertexBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this._vertexBuffer),e.bufferData(e.ARRAY_BUFFER,s,e.STATIC_DRAW);const n=new Float32Array(99);for(let e=0;e<=10;e++)n[0+3*e+0]=e/2.5-2,n[0+3*e+1]=0,n[0+3*e+2]=0;for(let e=0;e<=10;e++)n[33+3*e+0]=0,n[33+3*e+1]=e/2.5-2,n[33+3*e+2]=0;for(let e=0;e<=10;e++)n[66+3*e+0]=0,n[66+3*e+1]=0,n[66+3*e+2]=e/2.5-2;this._vertexCount2=33,this._vertexBuffer2=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this._vertexBuffer2),e.bufferData(e.ARRAY_BUFFER,n,e.STATIC_DRAW)}_cleanupWebGl(e){e.deleteBuffer(this._vertexBuffer),e.deleteBuffer(this._vertexBuffer2),e.deleteProgram(this._shaderProgram),this._vertexBuffer=null,this._vertexBuffer2=null,this._shaderProgram=null}}t.GaglAxesView=r}));